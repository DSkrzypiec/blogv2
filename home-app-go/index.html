<!DOCTYPE html><html lang="en" data-astro-cid-gvpn4u4b> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Home App v2 - rewritten in Go</title><style>*,*:before,*:after{box-sizing:border-box}html,body{max-width:100%;overflow-x:hidden}html{-webkit-text-size-adjust:100%}:root{--bg-color: #111010;--text-primary: #ffe9c6;--text-secondary: #2AA198;--accent-color: #f97d43;--font-body: "Roboto", sans-serif;--font-code: "JetBrains Mono", monospace}html{font-size:19px}@media (max-width: 480px){html{font-size:16px}}@media (max-width: 360px){html{font-size:15px}}body{font-size:1rem;line-height:1.66;background-color:var(--bg-color);color:var(--text-primary);font-family:var(--font-body);margin:0;padding:0;word-wrap:break-word;overflow-wrap:break-word}h1{font-size:2.25rem;line-height:1.2}h2{font-size:1.75rem;line-height:1.3}h3{font-size:1.35rem;line-height:1.35}@media (max-width: 768px){h1{font-size:2rem}h2{font-size:1.5rem}h3{font-size:1.2rem}}@media (max-width: 480px){h1{font-size:1.75rem}h2{font-size:1.35rem}h3{font-size:1.1rem}}@media (max-width: 360px){h1{font-size:1.6rem}h2{font-size:1.25rem}h3{font-size:1.05rem}}a{color:var(--text-secondary);text-decoration:none}a:hover{text-decoration:underline}pre{background-color:#1e1e1e;border-radius:8px;padding:1rem;overflow-x:auto;margin:1rem 0;font-size:15px;font-family:var(--font-code)}code{background-color:transparent}pre>code{display:block}.toc ul{list-style:none;margin:0;padding:0}.toc li{margin:.5rem 0}.toc a{color:var(--text-secondary);text-decoration:none}.toc a:hover{text-decoration:underline}.toc a.active{font-weight:700;color:var(--accent-color)}nav[data-astro-cid-dmqpwcec]{padding:1rem 0;text-align:center}ul[data-astro-cid-dmqpwcec]{list-style:none;padding:0;margin:0;display:flex;justify-content:center;gap:1.5rem;flex-wrap:wrap}@media (max-width: 480px){ul[data-astro-cid-dmqpwcec]{gap:1rem}a[data-astro-cid-dmqpwcec]{font-size:1rem;padding:.4rem .8rem}}@media (max-width: 360px){ul[data-astro-cid-dmqpwcec]{gap:.5rem}a[data-astro-cid-dmqpwcec]{font-size:.9rem;padding:.3rem .6rem}}li[data-astro-cid-dmqpwcec]{display:inline}a[data-astro-cid-dmqpwcec]{color:var(--text-primary);font-size:1.2rem;padding:.5rem 1rem;border:1px solid transparent;transition:all .3s ease-in-out}a[data-astro-cid-dmqpwcec]:hover{border:1px solid var(--accent-color);border-radius:4px;color:var(--accent-color)}.active[data-astro-cid-dmqpwcec] a[data-astro-cid-dmqpwcec]{color:var(--accent-color);font-weight:700;border-bottom:2px solid var(--accent-color)}hr[data-astro-cid-dmqpwcec]{margin-top:1rem;border:none;height:2px;background:var(--text-secondary);width:90%;max-width:800px;margin-left:auto;margin-right:auto}
.post-title[data-astro-cid-resui2ln]{margin-bottom:2rem}.post-title[data-astro-cid-resui2ln] h1[data-astro-cid-resui2ln]{font-size:1.75rem;color:var(--accent-color);margin:0}.post-date[data-astro-cid-resui2ln]{font-size:1rem;color:var(--text-secondary);margin-top:.5rem}.publish-label[data-astro-cid-resui2ln]{font-weight:700;color:var(--text-primary)}
.chapter[data-astro-cid-5d3zeytc]{font-size:2rem;margin-top:2rem;color:var(--accent-color)}.chapter[data-astro-cid-5d3zeytc] a[data-astro-cid-5d3zeytc]{color:var(--accent-color);text-decoration:none}.chapter[data-astro-cid-5d3zeytc] a[data-astro-cid-5d3zeytc]:hover{text-decoration:underline}
.post-layout{display:flex;flex-direction:row}@media (min-width: 1024px){.post-layout{flex-direction:row}.post-layout-sidebar{position:fixed;left:2rem;top:10rem;width:200px;font-size:.85rem;padding:1rem;z-index:10}.post-layout-content{flex:1;max-width:1000px;margin:0 auto;padding-left:240px;padding-right:2rem}}@media (min-width: 1400px){.post-layout-content{max-width:1200px}}.post-layout-sidebar{display:none}@media (min-width: 1024px){.post-layout-sidebar{display:block}}@media (max-width: 1023px){.post-layout{flex-direction:column}.post-layout-content{width:100%;max-width:100%}}:global(pre){width:100%!important;max-width:100%!important;overflow-x:auto;box-sizing:border-box}:global(.astro-code){width:100%!important;max-width:100%!important;box-sizing:border-box}:global(.astro-code pre){width:100%!important;max-width:100%!important;overflow-x:auto;box-sizing:border-box}:global(.post-layout-content pre){max-width:100%!important;overflow-x:auto;word-wrap:break-word;white-space:pre-wrap}main[data-astro-cid-gvpn4u4b]{padding:2rem 1rem;max-width:900px;margin:0 auto;width:100%;box-sizing:border-box}@media (min-width: 1024px){main[data-astro-cid-gvpn4u4b]{padding:2rem 0;max-width:none}}@media (max-width: 768px){main[data-astro-cid-gvpn4u4b]{padding:1.5rem .75rem}}@media (max-width: 480px){main[data-astro-cid-gvpn4u4b]{padding:1rem .5rem}}article[data-astro-cid-gvpn4u4b]{max-width:800px;width:100%;margin:0 auto;color:var(--text-primary);box-sizing:border-box;word-wrap:break-word;overflow-wrap:break-word}h1[data-astro-cid-gvpn4u4b],h2[data-astro-cid-gvpn4u4b],h3[data-astro-cid-gvpn4u4b]{color:var(--accent-color);margin-top:1.5rem;word-wrap:break-word;overflow-wrap:break-word}p[data-astro-cid-gvpn4u4b]{color:var(--text-secondary);word-wrap:break-word;overflow-wrap:break-word;hyphens:auto}img[data-astro-cid-gvpn4u4b]{max-width:100%;max-height:400px;width:auto;height:auto;border-radius:8px;margin:1rem 0;object-fit:contain}@media (max-width: 768px){img[data-astro-cid-gvpn4u4b]{max-height:300px}}@media (max-width: 480px){img[data-astro-cid-gvpn4u4b]{max-height:250px}}blockquote[data-astro-cid-gvpn4u4b]{border-left:4px solid var(--accent-color);padding-left:1rem;color:var(--text-primary);font-style:italic;margin:1rem 0}code[data-astro-cid-gvpn4u4b]{font-family:monospace;background:#ffffff1a;padding:.2rem .4rem;border-radius:4px;font-size:.95rem}
.image-container[data-astro-cid-6kov3kig]{display:flex;flex-direction:column;align-items:center;margin:1.5rem 0}.image-container[data-astro-cid-6kov3kig] img[data-astro-cid-6kov3kig]{width:auto;height:auto;border-radius:8px;object-fit:contain;box-shadow:0 4px 8px #0000001a}.image-container[data-astro-cid-6kov3kig] img[data-astro-cid-6kov3kig].inverted{filter:invert(1)}.image-caption[data-astro-cid-6kov3kig]{margin-top:.5rem;font-size:.9rem;color:var(--text-secondary, #666);font-style:italic;text-align:center;max-width:600px}@media (max-width: 768px){.image-container[data-astro-cid-6kov3kig]{margin:1rem 0}.image-container[data-astro-cid-6kov3kig] img[data-astro-cid-6kov3kig]{max-height:300px!important}}@media (max-width: 480px){.image-container[data-astro-cid-6kov3kig] img[data-astro-cid-6kov3kig]{max-height:250px!important}.image-caption[data-astro-cid-6kov3kig]{font-size:.8rem;padding:0 1rem}}
</style></head> <body data-astro-cid-gvpn4u4b> <header data-astro-cid-gvpn4u4b> <nav data-astro-cid-dmqpwcec> <ul data-astro-cid-dmqpwcec> <li class data-astro-cid-dmqpwcec> <a href="/" data-astro-cid-dmqpwcec>Posts</a> </li><li class data-astro-cid-dmqpwcec> <a href="/about" data-astro-cid-dmqpwcec>About</a> </li><li class data-astro-cid-dmqpwcec> <a href="/resume" data-astro-cid-dmqpwcec>Resume</a> </li> </ul> </nav>  </header> <!-- 
      1) Wrap sidebar + main in a single parent .post-layout
         so flexbox can place them side by side on large screens 
    --> <div class="post-layout" data-astro-cid-gvpn4u4b> <!-- SIDEBAR --> <aside class="post-layout-sidebar" data-astro-cid-gvpn4u4b> <!-- The nav container that will hold our generated TOC --><nav id="table-of-contents" class="toc"></nav> <script client:load>
  window.addEventListener('DOMContentLoaded', () => {
    buildTOC();
    highlightActiveHeading();
  });

  // 1. Build the TOC once the page is loaded
  function buildTOC() {
    const chapterHeadings = Array.from(document.querySelectorAll('h2.chapter[id]'));
    const tocContainer = document.getElementById('table-of-contents');
    if (!tocContainer) return;

    const ul = document.createElement('ul');

    chapterHeadings.forEach((heading) => {
      const li = document.createElement('li');
      const a = document.createElement('a');

      // The heading has an `id` like "intro" or "symptoms"
      a.href = `#${heading.id}`;

      a.textContent = heading.textContent.trim();

      li.appendChild(a);
      ul.appendChild(li);
    });

    tocContainer.appendChild(ul);
  }

    function highlightActiveHeading() {
      const links = Array.from(document.querySelectorAll('#table-of-contents a'));
      const headingEls = links.map((link) => document.getElementById(link.hash.slice(1)));

      // 3. Create the observer
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            console.log(
              `Heading: ${entry.target.id}, isIntersecting: ${entry.isIntersecting}`
            );
            if (entry.isIntersecting) {
              // Remove 'active' from all links
              links.forEach((l) => l.classList.remove('active'));

              // Highlight the link for the heading that just entered
              const activeLink = links.find(
                (l) => l.hash === `#${entry.target.id}`
              );
              if (activeLink) {
                activeLink.classList.add('active');
              }
            }
          });
        },
        {
          root: null,
          rootMargin: '-15% 0px -60% 0px',
          threshold: 0,
        }
      );

      // 4. Observe each heading
      headingEls.forEach((el) => {
        if (el) {
          console.log(`Observing heading: ${el.id}`);
          observer.observe(el);
        }
      });
    }
</script> </aside> <!-- MAIN CONTENT AREA --> <div class="post-layout-content" data-astro-cid-gvpn4u4b> <main data-astro-cid-gvpn4u4b> <article data-astro-cid-gvpn4u4b>  <div class="post-title" data-astro-cid-resui2ln> <h1 data-astro-cid-resui2ln>Home App v2 - rewritten in Go</h1> <p class="post-date" data-astro-cid-resui2ln> <span class="publish-label" data-astro-cid-resui2ln>Publish date:</span> 2022-11-26 </p> </div>  <div class="image-container" data-astro-cid-6kov3kig> <img src="/home-app-go/homeApp.png" alt="Home App interface screenshot" style="max-width: 100%; max-height: 400px;" class data-astro-cid-6kov3kig> <p class="image-caption" data-astro-cid-6kov3kig>Home App v2 interface showing the main dashboard</p> </div>  <h2 id="intro" class="chapter" data-astro-cid-5d3zeytc> <a href="#intro" data-astro-cid-5d3zeytc>Intro</a> </h2>  <p>
Two years ago I've introduced <a href="https://dskrzypiec.dev/home-db">Home Database</a>
with corresponding Home App written in ASP.NET Core MVC (C#). The original idea
    was to have a database for keeping very personal documents and other data
    related to me, my home and my family. More about motivations can be found
    in the linked post about Home Database.
</p> <p>
In case if you want to explore dev version of Home App before reading this
    post, you can visit
</p> <ul> <li><a href="https://homeappdev.dskrzypiec.dev">https://homeappdev.dskrzypiec.dev</a>
or <a href="http://3.74.170.81">http://3.74.170.81</a> if previous doesn't work</li> <li>and use credentials <code>testuser/password</code></li> </ul> <p>
Or you can compile it from <a href="https://github.com/dskrzypiec/homeAppGo">source code</a> and run locally.
</p> <h2 id="home-database" class="chapter" data-astro-cid-5d3zeytc> <a href="#home-database" data-astro-cid-5d3zeytc>Home Database after two years</a> </h2>  <p>
Even though development of Home App stuck a bit, we were actively using it. Over
    past two years we gathered around 230 scanned (or in digital version)
    documents, almost 4500 bank transactions and kept record of our water and
    energy counters. Home Database has increased in size from ~50 MB to ~300 MB.
    I'm glad that it didn't turn out as a regular side project which is parked
    indefinitely.
</p> <p>
It become a really handy when I had to pick up some of those
    documents. It happens more often than I initially expected. Also, as it turned
    out, almost always digital version is sufficient and there is no need for
    physical copy. While changing companies I had to provide diplomas and other
    documents. Moreover I was required to fill many legal forms. All of it I've
    done using documents from Home Database and it took me significantly faster
    without any effort comparing to browsing through stacks of paper documents.
</p> <h2 id="why-v2" class="chapter" data-astro-cid-5d3zeytc> <a href="#why-v2" data-astro-cid-5d3zeytc>Why v2?</a> </h2>  <p>
Regarding original version written in C# I haven't made a single commit since
    mid-June 2021. It's hard to describe why exactly. I was thinking about
    developing new features but I didn't want to continuing doing so in ASP.NET.
    Perhaps it wasn't fun anymore? I'm not sure. Nevertheless recently I though it
    would be better if I rewrite this app in Go. Firstly, because I was convinced
    that in this framework I would want to continue developing the app. One might
    ask why suddenly I've changed my mind, because I considered Go in 2020 and I
    didn't go for it. There are three reasons
</p> <ol> <li>Now there is a <a href="https://pkg.go.dev/modernc.org/sqlite">Go driver for SQLite</a>
without using <em>cgo</em></li> <li>I've tested that using <a href="https://pkg.go.dev/html/template">html/template
       package</a> with basic CSS might get pretty
       good UI</li> <li>Moving Home App online</li> </ol> <p>
In 2020 the first two points were not met, therefore I choose C# over Go.
    Regarding moving online. In the first version Home App was hosted on my RPi
    within Tailscale network, so only handful of devices could access the
    application. It was fine for me, but for other users (my wife) it was rather
    poor UX.
</p> <h2 id="migration-go" class="chapter" data-astro-cid-5d3zeytc> <a href="#migration-go" data-astro-cid-5d3zeytc>Migration to Go</a> </h2>  <div class="image-container" data-astro-cid-6kov3kig> <img src="/home-app-go/gh_languages.png" alt="GitHub languages chart" style="max-width: 100%; max-height: 400px;" class data-astro-cid-6kov3kig> <p class="image-caption" data-astro-cid-6kov3kig>GitHub languages chart showing Go as the primary language</p> </div>  <h3>MVC</h3> <p>
Regarding high level design in both C# and Go versions I've implemented
<a href="https://en.wikipedia.org/wiki/Model–view–controller">MVC</a> approach. It's
    suitable because of two reasons. The first one is that I don't do much frontend and
    the other one is fact that Home App is, and probably will be, rather straightforward
    application regarding UI and UX.
</p> <p>
In Go I've used standard <code>html/template</code> package for generating HTML templates
    and then rendering those using populated models. This package supports
    including other templates, conditional expressions, using variables and looping
    over collections. That's definitely enough for my needs. One of Home App pages
    is generated using the following HTML template:
</p> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="html"><code><span class="line"><span style="color:#808080">&#x3C;!</span><span style="color:#569CD6">DOCTYPE</span><span style="color:#9CDCFE"> html</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#808080">&#x3C;</span><span style="color:#569CD6">html</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#808080">&#x3C;</span><span style="color:#569CD6">head</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#D4D4D4">    {{ template "common-header" }}</span></span>
<span class="line"><span style="color:#808080">    &#x3C;</span><span style="color:#569CD6">style</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#D4D4D4">        {{ template "common-css" }}</span></span>
<span class="line"><span style="color:#808080">    &#x3C;/</span><span style="color:#569CD6">style</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#808080">&#x3C;/</span><span style="color:#569CD6">head</span><span style="color:#808080">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#808080">&#x3C;</span><span style="color:#569CD6">body</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#D4D4D4">    {{ template "common-logo" }}</span></span>
<span class="line"><span style="color:#D4D4D4">    {{ template "common-menu" }}</span></span>
<span class="line"><span style="color:#808080">    &#x3C;</span><span style="color:#569CD6">h1</span><span style="color:#808080">></span><span style="color:#D4D4D4">Finance</span><span style="color:#808080">&#x3C;/</span><span style="color:#569CD6">h1</span><span style="color:#808080">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#808080">    &#x3C;</span><span style="color:#569CD6">table</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#808080">        &#x3C;</span><span style="color:#569CD6">thead</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#D4D4D4">            ...</span></span>
<span class="line"><span style="color:#808080">        &#x3C;/</span><span style="color:#569CD6">thead</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#808080">        &#x3C;</span><span style="color:#569CD6">tbody</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#D4D4D4">        {{ range .MonthlyAggregation }}</span></span>
<span class="line"><span style="color:#808080">            &#x3C;</span><span style="color:#569CD6">tr</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#808080">                &#x3C;</span><span style="color:#569CD6">td</span><span style="color:#808080">></span><span style="color:#D4D4D4">{{.YearMonth}}</span><span style="color:#808080">&#x3C;/</span><span style="color:#569CD6">td</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#808080">                &#x3C;</span><span style="color:#569CD6">td</span><span style="color:#808080">></span><span style="color:#D4D4D4">{{.NumOfTransactions}}</span><span style="color:#808080">&#x3C;/</span><span style="color:#569CD6">td</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#808080">                &#x3C;</span><span style="color:#569CD6">td</span><span style="color:#808080">></span><span style="color:#D4D4D4">{{.Inflow}}</span><span style="color:#808080">&#x3C;/</span><span style="color:#569CD6">td</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#808080">                &#x3C;</span><span style="color:#569CD6">td</span><span style="color:#808080">></span><span style="color:#D4D4D4">{{.Outflow}}</span><span style="color:#808080">&#x3C;/</span><span style="color:#569CD6">td</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#808080">            &#x3C;/</span><span style="color:#569CD6">tr</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#D4D4D4">        {{ end }}</span></span>
<span class="line"><span style="color:#808080">        &#x3C;/</span><span style="color:#569CD6">tbody</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#808080">    &#x3C;/</span><span style="color:#569CD6">table</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#808080">&#x3C;/</span><span style="color:#569CD6">body</span><span style="color:#808080">></span></span>
<span class="line"><span style="color:#808080">&#x3C;/</span><span style="color:#569CD6">html</span><span style="color:#808080">></span></span></code></pre> <p>
It's concise and simple. There are some other templates included for common
    components and in the body we have a table generated based on
<code>MonthlyAggregation</code> object which is prepared in corresponding controller.
</p> <p>
In case if you're interested in reading more details:
</p> <ul> <li>All Home App HTML templates are defined <a href="https://github.com/DSkrzypiec/homeAppGo/tree/main/html">here</a></li> <li>All Home App controllers are defined within <code>homeApp/controller</code> package
<a href="https://github.com/DSkrzypiec/homeAppGo/tree/main/controller">here</a></li> </ul> <h3>SQLite and new driver</h3> <p>
In May 2022 I found out that there is a <a href="https://gitlab.com/cznic/sqlite">SQLite Go
    driver</a> which doesn't require C and <em>cgo</em> to
    compile. This package was done by automatic translation from C to Go. I think
    it's impressive! As expected this translation should be slower then actual
    hand-written C code, but <a href="https://datastation.multiprocess.io/blog/2022-05-12-sqlite-in-go-with-and-without-cgo.html">this
    benchmark</a> shows it's not that bad. Regarding Home App use-case that will be sufficient.
    Usually I'm not a fan of moving cost from compile-time to run-time but in this
    particular case keeping development process as smooth as possible is more
    important, than a bit slower <code>INSERT</code>s (which are performed at most few times
    per week).
</p> <h3>HTTP backend</h3> <p>
Most of backend code in Home App is related to accessing Home Database within
    HTTP handler and read or insert data. So almost everything touches networking
    layer in some sense. For now there was only one component which was separated
    and needed actual migration between projects. It's parsing PKO Bank XML dump
    file with transactions. This parser was rather small peace. I've migrated it
    using standard <code>encoding/xml</code> Go package in single evening (including unit
    tests).
</p> <p>
In general I feel that <code>net/http</code> library is a bit more pleasant to use
    comparing to ASP.NET. I feel that Go <code>net/http</code> is a bit lower level of
    abstraction then ASP.NET and I prefer it this way. Although I might be a bit
    biased, because I've spent more time in the past in networking in Go, than in
    C#.
</p> <h3>Full text search on documents</h3> <p>
It's not directly related to Go but I've planned to do this for a long time and
<code>v2</code> was the best opportunity to do it. SQLite provides full text search
    capability via <a href="https://www.sqlite.org/fts5.html">FTS5 extension</a>. Using it in
    SQLite is as easy as creating a corresponding virtual table
</p> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#569CD6">CREATE</span><span style="color:#D4D4D4"> VIRTUAL </span><span style="color:#569CD6">TABLE</span><span style="color:#569CD6"> IF</span><span style="color:#569CD6"> NOT</span><span style="color:#569CD6"> EXISTS</span><span style="color:#D4D4D4"> documentsFts5 </span><span style="color:#569CD6">USING</span><span style="color:#D4D4D4"> fts5(</span></span>
<span class="line"><span style="color:#D4D4D4">    DocumentId,</span></span>
<span class="line"><span style="color:#D4D4D4">    DocumentName,</span></span>
<span class="line"><span style="color:#D4D4D4">    UploadDate,</span></span>
<span class="line"><span style="color:#D4D4D4">    DocumentDate,</span></span>
<span class="line"><span style="color:#D4D4D4">    Category,</span></span>
<span class="line"><span style="color:#D4D4D4">    PersonInvolved,</span></span>
<span class="line"><span style="color:#D4D4D4">    FileExtension</span></span>
<span class="line"><span style="color:#D4D4D4">);</span></span></code></pre> <p>
As you can see for now full text search is performed over documents metadata
    (title, dates, category, person, etc.) and not its content but still it's good
    enough (for now) to browse documents.
</p> <p>
The only cost of <em>FTS</em> is keeping documents metadata duplicated, but in my
    opinion it's rather small cost for convenient google-like searching integrated
    in a half an hour.
</p> <h2 id="features" class="chapter" data-astro-cid-5d3zeytc> <a href="#features" data-astro-cid-5d3zeytc>Home App v2 features</a> </h2>  <ul> <li>Hosted online (new in v2)</li> <li>Two-factor authentication (2FA) via Telegram (new in v2)</li> <li>General statistics on home page (new in v2)</li> <li>View/insert counters state (water, energy)</li> <li>View statistics and insert financial transactions from <a href="https://www.pkobp.pl">PKO
      Bank</a></li> <li>Inserting new documents</li> <li>Browsing documents using full-text search (new in v2)</li> <li>Downloading documents</li> <li>[coming soon] book catalog with possibility of including and downloading e-books</li> </ul> <h2 id="going-online" class="chapter" data-astro-cid-5d3zeytc> <a href="#going-online" data-astro-cid-5d3zeytc>Going online</a> </h2>  <p>
For the last two years I've been hosting Home App and Home Database on a RPi in
    my home. During this period I had around 2-3 days of downtime totally. One of
    outages happened when I was two hours drive from home. After this incident I
    started to thinking about moving the application into the cloud. I could invest
    in some kind of UPS, but that wouldn't solve all problems. There was still a
    factor that application could be reached only within Tailscale network. The
    main problem with this approach is that to access Home App in some device I
    have to install Tailscale and login on that device. This is not a major problem
    but it's less flexible than just a web application.
</p> <p>
The new architecture of Home App is really simple. Application is hosted on AWS
    EC2 (compiled app + Home Database). To that EC2 I have load balancer attached
    to setup TLS (HTTPS). Finally this load balancer is setup with Amazon Route 53
    where my personal subdomain for the application is registered.
</p> <p>
I've setup two environments - dev and production. The dev environment was
    already mentioned - <a href="https://homeappdev.dskrzypiec.dev">https://homeappdev.dskrzypiec.dev</a>.
    I thought that is a good idea to share dev version of Home App which uses mock
    database without any sensitive data. For development process it's good that I
    can test process end-to-end on separated environment. The other reason is that
    if someone was interested in deploying their own version of my Home App, using
    mock database at the beginning should provide smooth introduction.
</p> <h3>Authentication</h3> <div class="image-container" data-astro-cid-6kov3kig> <img src="/home-app-go/hashed_pass.png" alt="Password hashing example" style="max-width: 100%; max-height: 400px;" class data-astro-cid-6kov3kig> <p class="image-caption" data-astro-cid-6kov3kig>Example of password hashing implementation</p> </div>  <p>
I've implemented rather standard user authentication where salted and hashed
    password is checked against original salted and hashed password from the Home
    Database. There is also second step of authentication (2FA) which requires that
    user have to send specific message on private <a href="https://telegram.org">Telegram</a>
channel within a minute. On dev environment 2FA is turned off. More on Telegram
    integration in the next chapter.
</p> <p>
In current version I've decided that there is no need for new user registration
    capability. All users that shall have access to Home App are added manually by
    the admin directly to the table in Home Database. Regarding 2FA all privileged
    users should also be added to the private Telegram channel.
</p> <h2 id="security" class="chapter" data-astro-cid-5d3zeytc> <a href="#security" data-astro-cid-5d3zeytc>Security</a> </h2>  <p>
Security of Home Database is still very important factor. Exposing Home App v2
    to the World created many security scenarios that have to be covered.
</p> <p>
The first one was how to keep "the server" with application and the database
    protected. In order to do so I've setup that connection to Home App EC2
    instance can be performed only via SSH using my private RSA key only from my IP
    or via HTTPS directly to Home App. So even when someone could get my RSA key
    for this instance he/she should have also get into my AWS account or using the
    same IP. Both are possible but very unlikely.
</p> <p>
The other matter was protection of the Home App itself. Beyond standard user
    authentication I've introduced second step of authentication via private
    Telegram channel. After successful authentication user got short-lived session
    token (10-15 minutes) via HTTP-only cookie. Moreover every endpoint, except
    login form, of Home App is protected by checking validation of session token.
</p> <p>
I'm not a security expert so this might not be a state-of-the-art setup but
    with combination of monitoring I feel rather safe. Still it would be simpler to
    break into my home and take part of those physical documents rather than
    hacking Home App.
</p> <h2 id="telegram" class="chapter" data-astro-cid-5d3zeytc> <a href="#telegram" data-astro-cid-5d3zeytc>Telegram</a> </h2>  <div class="image-container" data-astro-cid-6kov3kig> <img src="/home-app-go/telegram_chan.jpeg" alt="Telegram channel screenshot" style="max-width: 100%; max-height: 400px;" class data-astro-cid-6kov3kig> <p class="image-caption" data-astro-cid-6kov3kig>Telegram channel used for 2FA and notifications</p> </div>  <p>
I choose Telegram for 2FA and notification, because it's the main communicator
    I'm using together with my wife and the rest of the family. I have it installed
    on my mobile and also it can be accessed via web version, so it's always within
    my hand's reach. It's also much less of a hassle for other users in my family
    then using Tailscale.
</p> <p>
Primarily Telegram was choose for second step of 2FA. Later I thought it's also
    very convenient way to notify me and other users regarding activities and
    statistics.
</p> <h2 id="summary" class="chapter" data-astro-cid-5d3zeytc> <a href="#summary" data-astro-cid-5d3zeytc>Summary</a> </h2>  <p>
I'm really excited about both putting Home App online and migrating it to Go.
    At the moment Home App is rather a simple web application, thus migration took me
    less then three weeks of evenings and not every evening in that period. In
    current Go version I feel like adding new things and maintenance in general
    would be more pleasant for me.
</p> <p>
Additionally for me this migration was a good learning experience. Where on the
    backend side I've implemented similar things many times, there on the other
    side it's my first application that is hosted in public.
</p> <p>
I'm very happy that Home Database is alive and growing. I hope that with
    current better accessibility and availability of Home App it will bring much
    better experience for me and my family. I can feel it already but we'll see how
    it turned out in the future.
</p> <h2 id="references" class="chapter" data-astro-cid-5d3zeytc> <a href="#references" data-astro-cid-5d3zeytc>References</a> </h2>  <ol> <li><a href="https://dskrzypiec.dev/home-db">Home Database and Home App v1</a></li> <li><a href="https://github.com/dskrzypiec/homeAppGo">Home App v2 repo</a></li> <li><a href="https://datastation.multiprocess.io/blog/2022-05-12-sqlite-in-go-with-and-without-cgo.html">Go SQLite drivers benchmark</a></li> <li><a href="https://pkg.go.dev/modernc.org/sqlite">modernc.org/sqlite driver</a></li> <li><a href="https://www.sqlite.org/fts5.html">SQLite FTS5</a></li> <li><a href="https://core.telegram.org/bots/api">Telegram Bots API</a></li> </ol>  </article> </main> </div> </div>  <!-- Global styles for .post-layout and .post-layout-sidebar -->  </body></html>