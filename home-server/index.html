<!DOCTYPE html><html lang="en" data-astro-cid-gvpn4u4b> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Home Server</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.26/dist/katex.min.css" crossorigin="anonymous"><style>*,*:before,*:after{box-sizing:border-box}html,body{max-width:100%;overflow-x:hidden}html{-webkit-text-size-adjust:100%}:root{--bg-color: #111010;--text-primary: #ffe9c6;--text-secondary: #2AA198;--accent-color: #f97d43;--font-body: "Roboto", sans-serif;--font-code: "JetBrains Mono", monospace}html{font-size:19px}@media (max-width: 480px){html{font-size:16px}}@media (max-width: 360px){html{font-size:15px}}body{font-size:1rem;line-height:1.66;background-color:var(--bg-color);color:var(--text-primary);font-family:var(--font-body);margin:0;padding:0;word-wrap:break-word;overflow-wrap:break-word}h1{font-size:2.25rem;line-height:1.2}h2{font-size:1.75rem;line-height:1.3}h3{font-size:1.35rem;line-height:1.35}@media (max-width: 768px){h1{font-size:2rem}h2{font-size:1.5rem}h3{font-size:1.2rem}}@media (max-width: 480px){h1{font-size:1.75rem}h2{font-size:1.35rem}h3{font-size:1.1rem}}@media (max-width: 360px){h1{font-size:1.6rem}h2{font-size:1.25rem}h3{font-size:1.05rem}}a{color:var(--text-secondary);text-decoration:none}a:hover{text-decoration:underline}pre{background-color:#1e1e1e;border-radius:8px;padding:1rem;overflow-x:auto;margin:1rem 0;font-size:15px;font-family:var(--font-code)}code{background-color:transparent}pre>code{display:block}.toc ul{list-style:none;margin:0;padding:0}.toc li{margin:.5rem 0}.toc a{color:var(--text-secondary);text-decoration:none}.toc a:hover{text-decoration:underline}.toc a.active{font-weight:700;color:var(--accent-color)}nav[data-astro-cid-dmqpwcec]{padding:1rem 0;text-align:center}ul[data-astro-cid-dmqpwcec]{list-style:none;padding:0;margin:0;display:flex;justify-content:center;gap:1.5rem;flex-wrap:wrap}@media (max-width: 480px){ul[data-astro-cid-dmqpwcec]{gap:1rem}a[data-astro-cid-dmqpwcec]{font-size:1rem;padding:.4rem .8rem}}@media (max-width: 360px){ul[data-astro-cid-dmqpwcec]{gap:.5rem}a[data-astro-cid-dmqpwcec]{font-size:.9rem;padding:.3rem .6rem}}li[data-astro-cid-dmqpwcec]{display:inline}a[data-astro-cid-dmqpwcec]{color:var(--text-primary);font-size:1.2rem;padding:.5rem 1rem;border:1px solid transparent;transition:all .3s ease-in-out}a[data-astro-cid-dmqpwcec]:hover{border:1px solid var(--accent-color);border-radius:4px;color:var(--accent-color)}.active[data-astro-cid-dmqpwcec] a[data-astro-cid-dmqpwcec]{color:var(--accent-color);font-weight:700;border-bottom:2px solid var(--accent-color)}hr[data-astro-cid-dmqpwcec]{margin-top:1rem;border:none;height:2px;background:var(--text-secondary);width:90%;max-width:800px;margin-left:auto;margin-right:auto}
.post-title[data-astro-cid-resui2ln]{margin-bottom:2rem}.post-title[data-astro-cid-resui2ln] h1[data-astro-cid-resui2ln]{font-size:1.75rem;color:var(--accent-color);margin:0}.post-date[data-astro-cid-resui2ln]{font-size:1rem;color:var(--text-secondary);margin-top:.5rem}.publish-label[data-astro-cid-resui2ln]{font-weight:700;color:var(--text-primary)}
.chapter[data-astro-cid-5d3zeytc]{font-size:2rem;margin-top:2rem;color:var(--accent-color)}.chapter[data-astro-cid-5d3zeytc] a[data-astro-cid-5d3zeytc]{color:var(--accent-color);text-decoration:none}.chapter[data-astro-cid-5d3zeytc] a[data-astro-cid-5d3zeytc]:hover{text-decoration:underline}
.post-layout{display:flex;flex-direction:row}@media (min-width: 1024px){.post-layout{flex-direction:row}.post-layout-sidebar{position:fixed;left:2rem;top:10rem;width:200px;font-size:.85rem;padding:1rem;z-index:10}.post-layout-content{flex:1;max-width:1000px;margin:0 auto;padding-left:240px;padding-right:2rem}}@media (min-width: 1400px){.post-layout-content{max-width:1200px}}.post-layout-sidebar{display:none}@media (min-width: 1024px){.post-layout-sidebar{display:block}}@media (max-width: 1023px){.post-layout{flex-direction:column}.post-layout-content{width:100%;max-width:100%}}:global(pre){width:100%!important;max-width:100%!important;overflow-x:auto;box-sizing:border-box}:global(.astro-code){width:100%!important;max-width:100%!important;box-sizing:border-box}:global(.astro-code pre){width:100%!important;max-width:100%!important;overflow-x:auto;box-sizing:border-box}:global(.post-layout-content pre){max-width:100%!important;overflow-x:auto;word-wrap:break-word;white-space:pre-wrap}main[data-astro-cid-gvpn4u4b]{padding:2rem 1rem;max-width:900px;margin:0 auto;width:100%;box-sizing:border-box}@media (min-width: 1024px){main[data-astro-cid-gvpn4u4b]{padding:2rem 0;max-width:none}}@media (max-width: 768px){main[data-astro-cid-gvpn4u4b]{padding:1.5rem .75rem}}@media (max-width: 480px){main[data-astro-cid-gvpn4u4b]{padding:1rem .5rem}}article[data-astro-cid-gvpn4u4b]{max-width:800px;width:100%;margin:0 auto;color:var(--text-primary);box-sizing:border-box;word-wrap:break-word;overflow-wrap:break-word}h1[data-astro-cid-gvpn4u4b],h2[data-astro-cid-gvpn4u4b],h3[data-astro-cid-gvpn4u4b]{color:var(--accent-color);margin-top:1.5rem;word-wrap:break-word;overflow-wrap:break-word}p[data-astro-cid-gvpn4u4b]{color:var(--text-secondary);word-wrap:break-word;overflow-wrap:break-word;hyphens:auto}img[data-astro-cid-gvpn4u4b]{max-width:100%;max-height:400px;width:auto;height:auto;border-radius:8px;margin:1rem 0;object-fit:contain}@media (max-width: 768px){img[data-astro-cid-gvpn4u4b]{max-height:300px}}@media (max-width: 480px){img[data-astro-cid-gvpn4u4b]{max-height:250px}}blockquote[data-astro-cid-gvpn4u4b]{border-left:4px solid var(--accent-color);padding-left:1rem;color:var(--text-primary);font-style:italic;margin:1rem 0}code[data-astro-cid-gvpn4u4b]{font-family:monospace;background:#ffffff1a;padding:.2rem .4rem;border-radius:4px;font-size:.95rem}
.image-container[data-astro-cid-6kov3kig]{display:flex;flex-direction:column;align-items:center;margin:1.5rem 0}.image-container[data-astro-cid-6kov3kig] img[data-astro-cid-6kov3kig]{width:auto;height:auto;border-radius:8px;object-fit:contain;box-shadow:0 4px 8px #0000001a}.image-container[data-astro-cid-6kov3kig] img[data-astro-cid-6kov3kig].inverted{filter:invert(1)}.image-caption[data-astro-cid-6kov3kig]{margin-top:.5rem;font-size:.9rem;color:var(--text-secondary, #666);font-style:italic;text-align:center;max-width:600px}@media (max-width: 768px){.image-container[data-astro-cid-6kov3kig]{margin:1rem 0}.image-container[data-astro-cid-6kov3kig] img[data-astro-cid-6kov3kig]{max-height:300px!important}}@media (max-width: 480px){.image-container[data-astro-cid-6kov3kig] img[data-astro-cid-6kov3kig]{max-height:250px!important}.image-caption[data-astro-cid-6kov3kig]{font-size:.8rem;padding:0 1rem}}
</style></head> <body data-astro-cid-gvpn4u4b> <header data-astro-cid-gvpn4u4b> <nav data-astro-cid-dmqpwcec> <ul data-astro-cid-dmqpwcec> <li class data-astro-cid-dmqpwcec> <a href="/" data-astro-cid-dmqpwcec>Posts</a> </li><li class data-astro-cid-dmqpwcec> <a href="/about" data-astro-cid-dmqpwcec>About</a> </li><li class data-astro-cid-dmqpwcec> <a href="/resume.html" data-astro-cid-dmqpwcec>Resume</a> </li> </ul> </nav>  </header> <!-- 
      1) Wrap sidebar + main in a single parent .post-layout
         so flexbox can place them side by side on large screens 
    --> <div class="post-layout" data-astro-cid-gvpn4u4b> <!-- SIDEBAR --> <aside class="post-layout-sidebar" data-astro-cid-gvpn4u4b> <!-- The nav container that will hold our generated TOC --><nav id="table-of-contents" class="toc"></nav> <script client:load>
  window.addEventListener('DOMContentLoaded', () => {
    buildTOC();
    highlightActiveHeading();
  });

  // 1. Build the TOC once the page is loaded
  function buildTOC() {
    const chapterHeadings = Array.from(document.querySelectorAll('h2.chapter[id]'));
    const tocContainer = document.getElementById('table-of-contents');
    if (!tocContainer) return;

    const ul = document.createElement('ul');

    chapterHeadings.forEach((heading) => {
      const li = document.createElement('li');
      const a = document.createElement('a');

      // The heading has an `id` like "intro" or "symptoms"
      a.href = `#${heading.id}`;

      a.textContent = heading.textContent.trim();

      li.appendChild(a);
      ul.appendChild(li);
    });

    tocContainer.appendChild(ul);
  }

    function highlightActiveHeading() {
      const links = Array.from(document.querySelectorAll('#table-of-contents a'));
      const headingEls = links.map((link) => document.getElementById(link.hash.slice(1)));

      // 3. Create the observer
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            console.log(
              `Heading: ${entry.target.id}, isIntersecting: ${entry.isIntersecting}`
            );
            if (entry.isIntersecting) {
              // Remove 'active' from all links
              links.forEach((l) => l.classList.remove('active'));

              // Highlight the link for the heading that just entered
              const activeLink = links.find(
                (l) => l.hash === `#${entry.target.id}`
              );
              if (activeLink) {
                activeLink.classList.add('active');
              }
            }
          });
        },
        {
          root: null,
          rootMargin: '-15% 0px -60% 0px',
          threshold: 0,
        }
      );

      // 4. Observe each heading
      headingEls.forEach((el) => {
        if (el) {
          console.log(`Observing heading: ${el.id}`);
          observer.observe(el);
        }
      });
    }
</script> </aside> <!-- MAIN CONTENT AREA --> <div class="post-layout-content" data-astro-cid-gvpn4u4b> <main data-astro-cid-gvpn4u4b> <article data-astro-cid-gvpn4u4b>  <div class="post-title" data-astro-cid-resui2ln> <h1 data-astro-cid-resui2ln>Home Server</h1> <p class="post-date" data-astro-cid-resui2ln> <span class="publish-label" data-astro-cid-resui2ln>Publish date:</span> 2021-06-06 </p> </div>  <div class="image-container" data-astro-cid-6kov3kig> <img src="/home-server/rpi.jpg" alt="Raspberry Pi" style="max-width: 100%; max-height: 400px;" class data-astro-cid-6kov3kig> <p class="image-caption" data-astro-cid-6kov3kig>Raspberry Pi</p> </div>  <h2 id="intro" class="chapter" data-astro-cid-5d3zeytc> <a href="#intro" data-astro-cid-5d3zeytc>Intro</a> </h2>  <p>
I've finally setup my own server. It's great and I regret I haven't done it
    earlier. This post will be about my thoughts and experiences on setting up a
    home server.
</p> <p>
In my case a <strong>server</strong> is just a Raspberry Pi 4B so it's not a typical server
    with over 40 CPU cores and over 256 GB of RAM but technically it's still a
    server and it's enough for my use.
</p> <p>
For a while I though to make my <a href="https://dskrzypiec.dev/minipc">PC</a> a home
    server but Ryzen 3700X definitely needs more power than Raspberry Pi and is
    probably an overkill for a server used mainly by myself.
</p> <h2 id="architecture" class="chapter" data-astro-cid-5d3zeytc> <a href="#architecture" data-astro-cid-5d3zeytc>Architecture</a> </h2>  <p>
It is easy enough to buy a Raspberry Pi and set it up in local network but in
    my opinion it's useless when you cannot connect to it securely outside of your
    local network. That's why I needed some kind of <em>Virtual Private Network</em> (VPN) for
    the server and my other devices.
</p> <p>
I choose <a href="https://tailscale.com">tailscale</a>. I don't have much experience in
    VPN tools but this one is a really good tool. At least two ex-Googlers from Go
    team (<a href="https://github.com/bradfitz">Brad Fitzpatrick</a>
and <a href="https://github.com/crawshaw">David Crawshaw</a>) hacked on this.
    In my opinion it's good because of the following reasons:
</p> <ol> <li><em>Just workz</em>, on most operating systems and CPU architectures</li> <li>Minimalistic and lightweight</li> <li>Zero config</li> <li>Provide static IP for each device within the network</li> <li>Free (as in price) for my usage (single user, many devices)</li> </ol> <p>
So in this architecture I can connect to the home server over SSH from any
    device which has tailscale installed. All my laptops and PC already had
    tailscale installed. Furthermore my android smartphone have Termux and
    tailscale on it, so I can also use the server directly from my smartphone.
    Which is really cool, even better than
<a href="https://dskrzypiec.dev/smartphone">writing blog post on smartphone</a>.
</p> <h2 id="setup" class="chapter" data-astro-cid-5d3zeytc> <a href="#setup" data-astro-cid-5d3zeytc>Setup</a> </h2>  <p>
Before my ordered Raspberry Pi arrived I've already installed Ubuntu Server
    20.04 on a microSD card (default RPi storage). This was my first experience
    with Ubuntu <strong>Server</strong>. It's just like a regular Ubuntu Desktop but without any
    unnecessary bloat like UI and default software and GUI programs. So basically
    you got a Linux terminal with *NIX tools. At this price OS have significantly
    smaller footprint than regular Ubuntu. Running server version consumes only
    about <code>200MB</code> of RAM.
</p> <p>
On the day when RPi arrived I've already had prepared OS so I could start with
    setting up the environment. In just under two hours I manage to:
</p> <ol> <li>setup basics for Linux like <code>.bashrc</code> with my aliases and <code>.vimrc</code> with my setup</li> <li>install .NET Core 3.1</li> <li>install tailscale</li> <li>install <a href="https://www.tarsnap.com">Tarsnap</a> and configure my private key</li> <li>restore latest backup of the <a href="https://dskrzypiec.dev/home-db">Home DB</a> via Tarsnap</li> <li>clone repo of my Home App and successfully compile the project (RPi is ARM
      based CPU)</li> <li>adjust configs of Home App and run it in the background</li> <li>test SSH and port forwarding from another devices</li> <li>access Home App from my smartphone via SSH port forwarding inside my VPN</li> </ol> <p>
I was very surprised that I've manage to pulled it off in just one evening,
    because I expected some kind of issues or surprises. But everything went great.
    Another evening and I've setup scripts for automated backups and some utility
    scripts to my convenience while using the server from mobile devices.
</p> <h2 id="security" class="chapter" data-astro-cid-5d3zeytc> <a href="#security" data-astro-cid-5d3zeytc>Security</a> </h2>  <p>
The server uses two level of security. The first is VPN and another is SSH. As
    I mentioned before I use tailscale to create a VPN for my devices. For details
    how tailscale works I recommend
<a href="https://tailscale.com/blog/how-tailscale-works/">this</a> article.
    In order to connect to my server client device have to be authorized by
    tailscale. To connect within the VPN a device to the server SSH is used.
</p> <p>
So my Home DB still lives only on my <em>local</em> device which happens to be secured
    server. In order to access Home App I've to use SSH port forwarding from
    server's <em>localhost</em> port onto SSH client port. Practically that means I still
    use my Home App in local environment but in help of VPN and SSH protocol I can
    securely access the app from another devices.
</p> <p>
Regarding secure online backups I still use Tarsnap.
</p> <h2 id="why-not-cloud" class="chapter" data-astro-cid-5d3zeytc> <a href="#why-not-cloud" data-astro-cid-5d3zeytc>Why this instead of the cloud?</a> </h2>  <p>
Why setting up your own server instead of just use one of <em>clouds</em>?
    Main reason was to keep my Home DB private. In theory I could store my database
    in encrypted form on the cloud and make Home App to handle decryption.
    But at this moment I'm not able to do that properly, according to security best
    practices. Second reason is that I feel less dependent on the others. I don't need
    the key feature of the cloud infrastructure which is easy scalability. By
    definition Home App and Home DB will stay local.
</p> <p>
Last but not least electricity and cost of Raspberry Pi is much lower than
    keeping up virtual machine 24/7/365 for significant period of time.
</p> <h2 id="usage" class="chapter" data-astro-cid-5d3zeytc> <a href="#usage" data-astro-cid-5d3zeytc>Usage</a> </h2>  <p>
As I stated before this Home Server serves mainly my Home App and Home DB.
    But this service is very low request per seconds. I could say it's rather
    (few) requests per day. That gives a lot of room for other stuff.
</p> <p>
Additionally I store on the server mirrors of my GitHub repos and other side
    projects. I've set up environment for compiling projects in technologies I use
    in case I'd need to check something out remotely.
</p> <p>
I feel that possibilities are endless and I just started exploring them.
</p> <h2 id="summary" class="chapter" data-astro-cid-5d3zeytc> <a href="#summary" data-astro-cid-5d3zeytc>Summary</a> </h2>  <p>
Overall I'm very satisfied and happy with setting up my own server. I'm
    feeling comfortable that I can access my Home App from all of my devices from
    anywhere in secure fashion.
</p> <p>
Another reason I'm happy about is having a place which is running 24/7 where
    I've prepared development environments and all of kinds config files. In
    particular I can easily synchronize those on a new device.
</p>  </article> </main> </div> </div>  <!-- Global styles for .post-layout and .post-layout-sidebar -->  </body></html>