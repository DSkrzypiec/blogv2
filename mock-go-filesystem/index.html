<!DOCTYPE html><html lang="en" data-astro-cid-gvpn4u4b> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Mocking a file system in Go</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.26/dist/katex.min.css" crossorigin="anonymous"><style>*,*:before,*:after{box-sizing:border-box}html,body{max-width:100%;overflow-x:hidden}html{-webkit-text-size-adjust:100%}:root{--bg-color: #111010;--text-primary: #ffe9c6;--text-secondary: #2AA198;--accent-color: #f97d43;--font-body: "Roboto", sans-serif;--font-code: "JetBrains Mono", monospace}html{font-size:19px}@media (max-width: 480px){html{font-size:16px}}@media (max-width: 360px){html{font-size:15px}}body{font-size:1rem;line-height:1.66;background-color:var(--bg-color);color:var(--text-primary);font-family:var(--font-body);margin:0;padding:0;word-wrap:break-word;overflow-wrap:break-word}h1{font-size:2.25rem;line-height:1.2}h2{font-size:1.75rem;line-height:1.3}h3{font-size:1.35rem;line-height:1.35}@media (max-width: 768px){h1{font-size:2rem}h2{font-size:1.5rem}h3{font-size:1.2rem}}@media (max-width: 480px){h1{font-size:1.75rem}h2{font-size:1.35rem}h3{font-size:1.1rem}}@media (max-width: 360px){h1{font-size:1.6rem}h2{font-size:1.25rem}h3{font-size:1.05rem}}a{color:var(--text-secondary);text-decoration:none}a:hover{text-decoration:underline}pre{background-color:#1e1e1e;border-radius:8px;padding:1rem;overflow-x:auto;margin:1rem 0;font-size:15px;font-family:var(--font-code)}code{background-color:transparent}pre>code{display:block}.toc ul{list-style:none;margin:0;padding:0}.toc li{margin:.5rem 0}.toc a{color:var(--text-secondary);text-decoration:none}.toc a:hover{text-decoration:underline}.toc a.active{font-weight:700;color:var(--accent-color)}nav[data-astro-cid-dmqpwcec]{padding:1rem 0;text-align:center}ul[data-astro-cid-dmqpwcec]{list-style:none;padding:0;margin:0;display:flex;justify-content:center;gap:1.5rem;flex-wrap:wrap}@media (max-width: 480px){ul[data-astro-cid-dmqpwcec]{gap:1rem}a[data-astro-cid-dmqpwcec]{font-size:1rem;padding:.4rem .8rem}}@media (max-width: 360px){ul[data-astro-cid-dmqpwcec]{gap:.5rem}a[data-astro-cid-dmqpwcec]{font-size:.9rem;padding:.3rem .6rem}}li[data-astro-cid-dmqpwcec]{display:inline}a[data-astro-cid-dmqpwcec]{color:var(--text-primary);font-size:1.2rem;padding:.5rem 1rem;border:1px solid transparent;transition:all .3s ease-in-out}a[data-astro-cid-dmqpwcec]:hover{border:1px solid var(--accent-color);border-radius:4px;color:var(--accent-color)}.active[data-astro-cid-dmqpwcec] a[data-astro-cid-dmqpwcec]{color:var(--accent-color);font-weight:700;border-bottom:2px solid var(--accent-color)}hr[data-astro-cid-dmqpwcec]{margin-top:1rem;border:none;height:2px;background:var(--text-secondary);width:90%;max-width:800px;margin-left:auto;margin-right:auto}
.post-title[data-astro-cid-resui2ln]{margin-bottom:2rem}.post-title[data-astro-cid-resui2ln] h1[data-astro-cid-resui2ln]{font-size:1.75rem;color:var(--accent-color);margin:0}.post-date[data-astro-cid-resui2ln]{font-size:1rem;color:var(--text-secondary);margin-top:.5rem}.publish-label[data-astro-cid-resui2ln]{font-weight:700;color:var(--text-primary)}
.chapter[data-astro-cid-5d3zeytc]{font-size:2rem;margin-top:2rem;color:var(--accent-color)}.chapter[data-astro-cid-5d3zeytc] a[data-astro-cid-5d3zeytc]{color:var(--accent-color);text-decoration:none}.chapter[data-astro-cid-5d3zeytc] a[data-astro-cid-5d3zeytc]:hover{text-decoration:underline}
.post-layout{display:flex;flex-direction:row}@media (min-width: 1024px){.post-layout{flex-direction:row}.post-layout-sidebar{position:fixed;left:2rem;top:10rem;width:200px;font-size:.85rem;padding:1rem;z-index:10}.post-layout-content{flex:1;max-width:1000px;margin:0 auto;padding-left:240px;padding-right:2rem}}@media (min-width: 1400px){.post-layout-content{max-width:1200px}}.post-layout-sidebar{display:none}@media (min-width: 1024px){.post-layout-sidebar{display:block}}@media (max-width: 1023px){.post-layout{flex-direction:column}.post-layout-content{width:100%;max-width:100%}}:global(pre){width:100%!important;max-width:100%!important;overflow-x:auto;box-sizing:border-box}:global(.astro-code){width:100%!important;max-width:100%!important;box-sizing:border-box}:global(.astro-code pre){width:100%!important;max-width:100%!important;overflow-x:auto;box-sizing:border-box}:global(.post-layout-content pre){max-width:100%!important;overflow-x:auto;word-wrap:break-word;white-space:pre-wrap}main[data-astro-cid-gvpn4u4b]{padding:2rem 1rem;max-width:900px;margin:0 auto;width:100%;box-sizing:border-box}@media (min-width: 1024px){main[data-astro-cid-gvpn4u4b]{padding:2rem 0;max-width:none}}@media (max-width: 768px){main[data-astro-cid-gvpn4u4b]{padding:1.5rem .75rem}}@media (max-width: 480px){main[data-astro-cid-gvpn4u4b]{padding:1rem .5rem}}article[data-astro-cid-gvpn4u4b]{max-width:800px;width:100%;margin:0 auto;color:var(--text-primary);box-sizing:border-box;word-wrap:break-word;overflow-wrap:break-word}h1[data-astro-cid-gvpn4u4b],h2[data-astro-cid-gvpn4u4b],h3[data-astro-cid-gvpn4u4b]{color:var(--accent-color);margin-top:1.5rem;word-wrap:break-word;overflow-wrap:break-word}p[data-astro-cid-gvpn4u4b]{color:var(--text-secondary);word-wrap:break-word;overflow-wrap:break-word;hyphens:auto}img[data-astro-cid-gvpn4u4b]{max-width:100%;max-height:400px;width:auto;height:auto;border-radius:8px;margin:1rem 0;object-fit:contain}@media (max-width: 768px){img[data-astro-cid-gvpn4u4b]{max-height:300px}}@media (max-width: 480px){img[data-astro-cid-gvpn4u4b]{max-height:250px}}blockquote[data-astro-cid-gvpn4u4b]{border-left:4px solid var(--accent-color);padding-left:1rem;color:var(--text-primary);font-style:italic;margin:1rem 0}code[data-astro-cid-gvpn4u4b]{font-family:monospace;background:#ffffff1a;padding:.2rem .4rem;border-radius:4px;font-size:.95rem}
</style></head> <body data-astro-cid-gvpn4u4b> <header data-astro-cid-gvpn4u4b> <nav data-astro-cid-dmqpwcec> <ul data-astro-cid-dmqpwcec> <li class data-astro-cid-dmqpwcec> <a href="/" data-astro-cid-dmqpwcec>Posts</a> </li><li class data-astro-cid-dmqpwcec> <a href="/about" data-astro-cid-dmqpwcec>About</a> </li><li class data-astro-cid-dmqpwcec> <a href="/resume.html" data-astro-cid-dmqpwcec>Resume</a> </li> </ul> </nav>  </header> <!-- 
      1) Wrap sidebar + main in a single parent .post-layout
         so flexbox can place them side by side on large screens 
    --> <div class="post-layout" data-astro-cid-gvpn4u4b> <!-- SIDEBAR --> <aside class="post-layout-sidebar" data-astro-cid-gvpn4u4b> <!-- The nav container that will hold our generated TOC --><nav id="table-of-contents" class="toc"></nav> <script client:load>
  window.addEventListener('DOMContentLoaded', () => {
    buildTOC();
    highlightActiveHeading();
  });

  // 1. Build the TOC once the page is loaded
  function buildTOC() {
    const chapterHeadings = Array.from(document.querySelectorAll('h2.chapter[id]'));
    const tocContainer = document.getElementById('table-of-contents');
    if (!tocContainer) return;

    const ul = document.createElement('ul');

    chapterHeadings.forEach((heading) => {
      const li = document.createElement('li');
      const a = document.createElement('a');

      // The heading has an `id` like "intro" or "symptoms"
      a.href = `#${heading.id}`;

      a.textContent = heading.textContent.trim();

      li.appendChild(a);
      ul.appendChild(li);
    });

    tocContainer.appendChild(ul);
  }

    function highlightActiveHeading() {
      const links = Array.from(document.querySelectorAll('#table-of-contents a'));
      const headingEls = links.map((link) => document.getElementById(link.hash.slice(1)));

      // 3. Create the observer
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            console.log(
              `Heading: ${entry.target.id}, isIntersecting: ${entry.isIntersecting}`
            );
            if (entry.isIntersecting) {
              // Remove 'active' from all links
              links.forEach((l) => l.classList.remove('active'));

              // Highlight the link for the heading that just entered
              const activeLink = links.find(
                (l) => l.hash === `#${entry.target.id}`
              );
              if (activeLink) {
                activeLink.classList.add('active');
              }
            }
          });
        },
        {
          root: null,
          rootMargin: '-15% 0px -60% 0px',
          threshold: 0,
        }
      );

      // 4. Observe each heading
      headingEls.forEach((el) => {
        if (el) {
          console.log(`Observing heading: ${el.id}`);
          observer.observe(el);
        }
      });
    }
</script> </aside> <!-- MAIN CONTENT AREA --> <div class="post-layout-content" data-astro-cid-gvpn4u4b> <main data-astro-cid-gvpn4u4b> <article data-astro-cid-gvpn4u4b>  <div class="post-title" data-astro-cid-resui2ln> <h1 data-astro-cid-resui2ln>Mocking a file system in Go</h1> <p class="post-date" data-astro-cid-resui2ln> <span class="publish-label" data-astro-cid-resui2ln>Publish date:</span> 2020-10-03 </p> </div>  <h2 id="intro" class="chapter" data-astro-cid-5d3zeytc> <a href="#intro" data-astro-cid-5d3zeytc>Intro</a> </h2>  <p>
In this post we'll try to mock some features of a file system in Go. We'll
    focus mainly on file tree structure instead on IO operations on files itself.
    If you are interested in full abstract file system for Go check out
<a href="https://github.com/spf13/afero">afero</a> package.
</p> <p>
If your application uses a file system (<em>FS</em>) a bit beyond just reading a single file
    then you should probably want to mock a <em>FS</em> in order to test it. Without
    mocking it only way to write unit tests is to actually create files, performs
    tests and clean up afterwards. It's slow (reaching to hard drive) and
    ineffective.
</p> <p>
Let's say we want to implement reading a file tree structure. For me natural
    representation of such a tree is the following:
</p> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#569CD6">type</span><span style="color:#4EC9B0"> Dir</span><span style="color:#569CD6"> struct</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#9CDCFE">    Path</span><span style="color:#4EC9B0">    string</span><span style="color:#D4D4D4">,</span></span>
<span class="line"><span style="color:#9CDCFE">    Files</span><span style="color:#D4D4D4">   []</span><span style="color:#4EC9B0">os</span><span style="color:#D4D4D4">.</span><span style="color:#4EC9B0">FileInfo</span><span style="color:#D4D4D4">,</span></span>
<span class="line"><span style="color:#9CDCFE">    SubDirs</span><span style="color:#569CD6"> map</span><span style="color:#D4D4D4">[</span><span style="color:#4EC9B0">string</span><span style="color:#D4D4D4">]</span><span style="color:#4EC9B0">Dir</span></span>
<span class="line"><span style="color:#D4D4D4">}</span></span></code></pre> <p>
Structure <code>Dir</code> have a <code>Path</code> path to root catalog, <code>Files</code> which is a list of meta
    information of files and a dictionary which maps a sub catalog name into actual
    sub catalog - another <code>Dir</code>. Which gives us recursive tree-like structure
    representing a file tree. I called it "natural" representation because it's
    usually the case shown in file explorers. Current catalog with files and other
    sub catalogs. Another representation could be just an array of <code>os.FileInfo</code>
extended by full path but it less natural for most people. It's more natural
    for computers though.
</p> <p>
Now I'd like to have some functionality which scans actual OS file system to
    provide <code>Dir</code> representation. On other hand I want to prepare mock <em>FS</em> in
    order to test that functionality without manual manipulation of actual <em>FS</em>.
</p> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#569CD6">func</span><span style="color:#DCDCAA"> Scan</span><span style="color:#D4D4D4">(...) (</span><span style="color:#4EC9B0">Dir</span><span style="color:#D4D4D4">, </span><span style="color:#4EC9B0">error</span><span style="color:#D4D4D4">) {</span></span>
<span class="line"><span style="color:#D4D4D4">    ...</span></span>
<span class="line"><span style="color:#D4D4D4">}</span></span></code></pre> <h2 id="interface" class="chapter" data-astro-cid-5d3zeytc> <a href="#interface" data-astro-cid-5d3zeytc>Interface</a> </h2>  <p>
I have not stated <code>Scan</code> function arguments yet. I'd like to use this function
    both on actual <em>FS</em> and also on mocked <em>FS</em>, so what should be an argument for
    that function? Yep, an interface. We should define minimal interface which
    would let us write recursive algorithm for scanning file tree.
</p> <p>
For given directory this interface should have functionalities to give us a
    list of files and sub directories, path of current location and something to
    reproduce or move itself for sub catalogs.
</p> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#569CD6">type</span><span style="color:#4EC9B0"> DirReader</span><span style="color:#569CD6"> interface</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#DCDCAA">    DirPath</span><span style="color:#D4D4D4">() </span><span style="color:#4EC9B0">string</span></span>
<span class="line"><span style="color:#DCDCAA">    Readdir</span><span style="color:#D4D4D4">() ([]</span><span style="color:#4EC9B0">os</span><span style="color:#D4D4D4">.</span><span style="color:#4EC9B0">FileInfo</span><span style="color:#D4D4D4">, </span><span style="color:#4EC9B0">error</span><span style="color:#D4D4D4">)</span></span>
<span class="line"><span style="color:#DCDCAA">    New</span><span style="color:#D4D4D4">(</span><span style="color:#4EC9B0">string</span><span style="color:#D4D4D4">) </span><span style="color:#4EC9B0">DirReader</span></span>
<span class="line"><span style="color:#D4D4D4">}</span></span></code></pre> <p>
The <code>DirReader</code> interface is my proposition to meet those requirements. It's
    composed of three methods - <code>DirPath</code> returns current location, <code>Readdir</code>
reads content of current catalog and <code>New</code> produce another <code>DirReader</code>
(assumable) for sub catalogs. Furthermore let's also note that type <code>os.FileInfo</code>
from the standard library is an interface. Details can be found
<a href="https://golang.org/pkg/os/#FileInfo">here</a>.
</p> <p>
Now we can finally pronounce signature of <code>Scan</code> function
</p> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#569CD6">func</span><span style="color:#DCDCAA"> Scan</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">reader</span><span style="color:#4EC9B0"> DirReader</span><span style="color:#D4D4D4">) (</span><span style="color:#4EC9B0">Dir</span><span style="color:#D4D4D4">, </span><span style="color:#4EC9B0">error</span><span style="color:#D4D4D4">) {</span></span>
<span class="line"><span style="color:#D4D4D4">    ...</span></span>
<span class="line"><span style="color:#D4D4D4">}</span></span></code></pre> <p>
At this point we could even provide a full implementation of <code>Scan</code> function
    using only <code>DirReader</code> interface definition. I'll leave this implementation in
    the Appendix to not distract us from main goal which is mocking a <em>FS</em>.
</p> <p>
In the next two sections we'll focus on implementing <code>DirReader</code> interface for actual
    OS file system using cross-platform <a href="https://golang.org/pkg/os/">os package</a>
and for mocked in-memory Go objects. This pattern, having an interface
    depending on interface rather then concrete type, is very broadly used despite
    particular programming language. I believe it originated in Simula with virtual
    functions and was later adopted by Bjarne Stroustrup in C++ in early 1980s. In
    C++ we could define abstract base class with methods similar to <code>DirReader</code>.
</p> <h2 id="actual-implementation" class="chapter" data-astro-cid-5d3zeytc> <a href="#actual-implementation" data-astro-cid-5d3zeytc>Actual implementation</a> </h2>  <p>
The actual implementation of <code>DirReader</code> which would use an actual OS file system
    is rather straightforward. Let's start from defining a new type which will
    represent single (non-recursive) directory - <code>FlatDir</code>.
</p> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#569CD6">type</span><span style="color:#4EC9B0"> FlatDir</span><span style="color:#569CD6"> struct</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#9CDCFE">    Path</span><span style="color:#4EC9B0"> string</span></span>
<span class="line"><span style="color:#D4D4D4">}</span></span></code></pre> <p>
To satisfy <code>DirReader</code> interface we've got to implement required methods.
    Getting directory's path and create a new <code>FlatDir</code> are trivial methods in this
    case:
</p> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#569CD6">func</span><span style="color:#D4D4D4"> (</span><span style="color:#9CDCFE">fd </span><span style="color:#4EC9B0">FlatDir</span><span style="color:#D4D4D4">) </span><span style="color:#DCDCAA">DirPath</span><span style="color:#D4D4D4">() </span><span style="color:#4EC9B0">string</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#C586C0">    return</span><span style="color:#9CDCFE"> fd</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">Path</span></span>
<span class="line"><span style="color:#D4D4D4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6">func</span><span style="color:#D4D4D4"> (</span><span style="color:#9CDCFE">fd </span><span style="color:#4EC9B0">FlatDir</span><span style="color:#D4D4D4">) </span><span style="color:#DCDCAA">New</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">path</span><span style="color:#4EC9B0"> string</span><span style="color:#D4D4D4">) </span><span style="color:#4EC9B0">DirReader</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#C586C0">    return</span><span style="color:#4EC9B0"> FlatDir</span><span style="color:#D4D4D4">{</span><span style="color:#9CDCFE">Path</span><span style="color:#D4D4D4">: </span><span style="color:#9CDCFE">path</span><span style="color:#D4D4D4">}</span></span>
<span class="line"><span style="color:#D4D4D4">}</span></span></code></pre> <p>
All of the work is done in <code>Readdir</code> method. We'll use functionalities from Go
<code>os</code> package to implement reading content of OS file system directory.
</p> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#569CD6">func</span><span style="color:#D4D4D4"> (</span><span style="color:#9CDCFE">fd </span><span style="color:#4EC9B0">FlatDir</span><span style="color:#D4D4D4">) </span><span style="color:#DCDCAA">Readdir</span><span style="color:#D4D4D4">() ([]</span><span style="color:#4EC9B0">os</span><span style="color:#D4D4D4">.</span><span style="color:#4EC9B0">FileInfo</span><span style="color:#D4D4D4">, </span><span style="color:#4EC9B0">error</span><span style="color:#D4D4D4">) {</span></span>
<span class="line"><span style="color:#9CDCFE">    currentDir</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">err</span><span style="color:#D4D4D4"> := </span><span style="color:#9CDCFE">os</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">Open</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">fd</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">Path</span><span style="color:#D4D4D4">)</span></span>
<span class="line"><span style="color:#C586C0">    if</span><span style="color:#9CDCFE"> err</span><span style="color:#D4D4D4"> != </span><span style="color:#569CD6">nil</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> nil</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">err</span></span>
<span class="line"><span style="color:#D4D4D4">    }</span></span>
<span class="line"><span style="color:#9CDCFE">    fileInfos</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">err</span><span style="color:#D4D4D4"> := </span><span style="color:#9CDCFE">currentDir</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">Readdir</span><span style="color:#D4D4D4">(-</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">)</span></span>
<span class="line"><span style="color:#C586C0">    if</span><span style="color:#9CDCFE"> err</span><span style="color:#D4D4D4"> != </span><span style="color:#569CD6">nil</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> nil</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">err</span></span>
<span class="line"><span style="color:#D4D4D4">    }</span></span>
<span class="line"><span style="color:#C586C0">    return</span><span style="color:#9CDCFE"> fileInfos</span><span style="color:#D4D4D4">, </span><span style="color:#569CD6">nil</span></span>
<span class="line"><span style="color:#D4D4D4">}</span></span></code></pre> <p>
That method is really just a wrapper on
<a href="https://golang.org/pkg/os/#File.Readdir">Readdir</a> method which is
    cross-platform and do the heavy lifting for us.
</p> <p>
After that type <code>FlatDir</code> satisfies <code>DirReader</code> interface. Now, in order to
    scan file tree for given root path, we could run <code>tree, err := Scan(FlatDir&#123;path&#125;)</code>.
</p> <h2 id="mock" class="chapter" data-astro-cid-5d3zeytc> <a href="#mock" data-astro-cid-5d3zeytc>Mock</a> </h2>  <p>
In order to prepare a mock for a file system we have to define an object which
    behaves like a file system and at the same time satisfies <code>DirReader</code> interface.
    As I stated at the beginning <code>Dir</code> is natural representation of a file system
    for me. Because of that my mock object will be very similar to <code>Dir</code>:
</p> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#569CD6">type</span><span style="color:#4EC9B0"> MockDir</span><span style="color:#569CD6"> struct</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#9CDCFE">    Path</span><span style="color:#4EC9B0">    string</span></span>
<span class="line"><span style="color:#9CDCFE">    Files</span><span style="color:#D4D4D4">   []</span><span style="color:#4EC9B0">os</span><span style="color:#D4D4D4">.</span><span style="color:#4EC9B0">FileInfo</span></span>
<span class="line"><span style="color:#9CDCFE">    SubDirs</span><span style="color:#569CD6"> map</span><span style="color:#D4D4D4">[</span><span style="color:#4EC9B0">string</span><span style="color:#D4D4D4">]*</span><span style="color:#4EC9B0">MockDir</span></span>
<span class="line"><span style="color:#D4D4D4">}</span></span></code></pre> <p>
Defined <code>MockDir</code> represents our mock <em>FS</em>. Using <code>map[string]*MockDir</code>
instead of <code>map[string]MockDir</code> is just for my convenience while building mock
    trees. In this version I can modify sub trees of the tree which was already
    initialized.
</p> <p>
To satisfy <code>DirReader</code> interface we, once again, have to provide implementation
    of methods <code>DirPath</code>, <code>Readdir</code> and <code>New</code>. The first one in this case also just
    returns <code>MockDir.Path</code>. Method <code>Readdir</code> returns all files from <code>MockDir.Files</code>
and based on <code>SubDirs</code> keys - sub catalog names also list of catalogs as
<code>[]os.FileInfo</code>. Method <code>New</code> is a bit tricky in context of the
    mock object. This method suppose to return a new <code>DirReader</code> for a given path.
    In this case we can do that only for sub catalogs of current tree, because
    there isn't any other valid path outside sub trees. Implementation of those
    three methods can be found in the Appendix.
</p> <p>
Wait but what about <code>MockDir.Files</code>? As we saw earlier <code>os.FileInfo</code> is an
    interface from Go standard library. We also have to mock this interface in
    order to produce <code>MockDir</code> objects. Let's define <code>MockFileInfo</code> type which
    would satisfy <code>os.FileInfo</code> interface:
</p> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#569CD6">type</span><span style="color:#4EC9B0"> MockFileInfo</span><span style="color:#569CD6"> struct</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#9CDCFE">    FileName</span><span style="color:#4EC9B0">    string</span></span>
<span class="line"><span style="color:#9CDCFE">    IsDirectory</span><span style="color:#4EC9B0"> bool</span></span>
<span class="line"><span style="color:#D4D4D4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6">func</span><span style="color:#D4D4D4"> (</span><span style="color:#9CDCFE">mfi </span><span style="color:#4EC9B0">MockFileInfo</span><span style="color:#D4D4D4">) </span><span style="color:#DCDCAA">Name</span><span style="color:#D4D4D4">() </span><span style="color:#4EC9B0">string</span><span style="color:#D4D4D4">       { </span><span style="color:#C586C0">return</span><span style="color:#9CDCFE"> mfi</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">FileName</span><span style="color:#D4D4D4"> }</span></span>
<span class="line"><span style="color:#569CD6">func</span><span style="color:#D4D4D4"> (</span><span style="color:#9CDCFE">mfi </span><span style="color:#4EC9B0">MockFileInfo</span><span style="color:#D4D4D4">) </span><span style="color:#DCDCAA">Size</span><span style="color:#D4D4D4">() </span><span style="color:#4EC9B0">int64</span><span style="color:#D4D4D4">        { </span><span style="color:#C586C0">return</span><span style="color:#4EC9B0"> int64</span><span style="color:#D4D4D4">(</span><span style="color:#B5CEA8">8</span><span style="color:#D4D4D4">) }</span></span>
<span class="line"><span style="color:#569CD6">func</span><span style="color:#D4D4D4"> (</span><span style="color:#9CDCFE">mfi </span><span style="color:#4EC9B0">MockFileInfo</span><span style="color:#D4D4D4">) </span><span style="color:#DCDCAA">Mode</span><span style="color:#D4D4D4">() </span><span style="color:#4EC9B0">os</span><span style="color:#D4D4D4">.</span><span style="color:#4EC9B0">FileMode</span><span style="color:#D4D4D4">  { </span><span style="color:#C586C0">return</span><span style="color:#9CDCFE"> os</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">ModePerm</span><span style="color:#D4D4D4"> }</span></span>
<span class="line"><span style="color:#569CD6">func</span><span style="color:#D4D4D4"> (</span><span style="color:#9CDCFE">mfi </span><span style="color:#4EC9B0">MockFileInfo</span><span style="color:#D4D4D4">) </span><span style="color:#DCDCAA">ModTime</span><span style="color:#D4D4D4">() </span><span style="color:#4EC9B0">time</span><span style="color:#D4D4D4">.</span><span style="color:#4EC9B0">Time</span><span style="color:#D4D4D4"> { </span><span style="color:#C586C0">return</span><span style="color:#9CDCFE"> time</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">Now</span><span style="color:#D4D4D4">() }</span></span>
<span class="line"><span style="color:#569CD6">func</span><span style="color:#D4D4D4"> (</span><span style="color:#9CDCFE">mfi </span><span style="color:#4EC9B0">MockFileInfo</span><span style="color:#D4D4D4">) </span><span style="color:#DCDCAA">IsDir</span><span style="color:#D4D4D4">() </span><span style="color:#4EC9B0">bool</span><span style="color:#D4D4D4">        { </span><span style="color:#C586C0">return</span><span style="color:#9CDCFE"> mfi</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">IsDirectory</span><span style="color:#D4D4D4"> }</span></span>
<span class="line"><span style="color:#569CD6">func</span><span style="color:#D4D4D4"> (</span><span style="color:#9CDCFE">mfi </span><span style="color:#4EC9B0">MockFileInfo</span><span style="color:#D4D4D4">) </span><span style="color:#DCDCAA">Sys</span><span style="color:#D4D4D4">() </span><span style="color:#569CD6">interface</span><span style="color:#D4D4D4">{}   { </span><span style="color:#C586C0">return</span><span style="color:#569CD6"> nil</span><span style="color:#D4D4D4"> }</span></span></code></pre> <p>
The actual object contains only information about file name and flag stating
    whenever this file is a catalog. In this particular case I don't need other
    file information like size or last modification date.
</p> <p>
Up to this point we've defined function <code>Scan</code> which scans a file tree based on
<code>DirReader</code> interface. We've got implementation of <code>DirReader</code> for actual OS
    file system and also implementation of mock <code>DirReader</code>. Hence we can use both
<code>FlatDir</code> and <code>MockDir</code> in <code>Scan</code> function.
</p> <p>
One last piece left is convenient building <code>MockDir</code> object for unit testing.
    I've found very useful to have a
<a href="https://gobyexample.com/variadic-functions">variadic function</a> to produce my
    mock file trees. In this situation we have a plenty of options but my first
    attempt was implement a helper function with the following signature
</p> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#569CD6">func</span><span style="color:#DCDCAA"> NewMockDir</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">rootPath</span><span style="color:#4EC9B0"> string</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">files</span><span style="color:#D4D4D4"> ...</span><span style="color:#4EC9B0">string</span><span style="color:#D4D4D4">) </span><span style="color:#4EC9B0">MockDir</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#D4D4D4">    ...</span></span>
<span class="line"><span style="color:#D4D4D4">}</span></span></code></pre> <p>
This function have an assumption about <code>files</code>. If single file name contains
<code>_</code> then it would be put inside sub catalog. For example
</p> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#9CDCFE">mockTree</span><span style="color:#D4D4D4"> := </span><span style="color:#DCDCAA">NewMockDir</span><span style="color:#D4D4D4">(</span><span style="color:#CE9178">"~/Downloads/"</span><span style="color:#D4D4D4">, </span><span style="color:#CE9178">"f1.go"</span><span style="color:#D4D4D4">, </span><span style="color:#CE9178">"f2.cpp"</span><span style="color:#D4D4D4">, </span></span>
<span class="line"><span style="color:#CE9178">                       "sub1_g.txt"</span><span style="color:#D4D4D4">, </span><span style="color:#CE9178">"sub2_h.html"</span><span style="color:#D4D4D4">)</span></span></code></pre> <p>
would create a file tree which looks like
</p> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>~/Downloads/</span></span>
<span class="line"><span>├── f1.go</span></span>
<span class="line"><span>├── f2.cpp</span></span>
<span class="line"><span>├── sub1/</span></span>
<span class="line"><span>│   └── g.txt</span></span>
<span class="line"><span>└── sub2/</span></span>
<span class="line"><span>    └── h.html</span></span></code></pre> <p>
In case when I need deeper trees I would use <code>NewMockDir</code> functions to create
    sub catalogs (and sub catalogs of sub catalogs...).
</p> <h2 id="summary" class="chapter" data-astro-cid-5d3zeytc> <a href="#summary" data-astro-cid-5d3zeytc>Summary</a> </h2>  <p>
Created <code>mockTree</code> is of type <code>MockDir</code> which satisfies <code>DirReader</code> interface.
    Hence we could use <code>Scan(mockTree)</code>, to produce actual file tree representation - <code>Dir</code>.
    That means now we are able to test every functionality which depends
    on <code>Dir</code> object. And that's great! We can easily and safely test manipulations
    of a file system. In praticular now we can setup scenarios which could be very
    difficult to create on actual OS file system like creating <code>1 &lt;&lt; 30</code> files or
    tree with very large depth.
</p> <p>
The idea of mocking a file system using an "interface" can be used in most of
    programming languages. What Go saves us is having already defined interface
<code>os.FileInfo</code> representing meta file information. In other languages we usually
    have to wrap it to abstract class or an interface and mock these afterwards.
</p> <h2 id="references" class="chapter" data-astro-cid-5d3zeytc> <a href="#references" data-astro-cid-5d3zeytc>References</a> </h2>  <ol> <li><a href="https://github.com/spf13/afero">Afero</a></li> <li><a href="https://golang.org/pkg/os/">Go 'os' package</a></li> <li><a href="https://github.com/dskrzypiec/dorg/">dorg</a></li> </ol> <h2 id="appendix" class="chapter" data-astro-cid-5d3zeytc> <a href="#appendix" data-astro-cid-5d3zeytc>Appendix</a> </h2>  <h3>Source code of <code>Scan</code> function:</h3> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#569CD6">func</span><span style="color:#DCDCAA"> Scan</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">reader</span><span style="color:#4EC9B0"> DirReader</span><span style="color:#D4D4D4">) (</span><span style="color:#4EC9B0">Dir</span><span style="color:#D4D4D4">, </span><span style="color:#4EC9B0">error</span><span style="color:#D4D4D4">) {</span></span>
<span class="line"><span style="color:#9CDCFE">    fileInfos</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">err</span><span style="color:#D4D4D4"> := </span><span style="color:#9CDCFE">reader</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">Readdir</span><span style="color:#D4D4D4">()</span></span>
<span class="line"><span style="color:#C586C0">    if</span><span style="color:#9CDCFE"> err</span><span style="color:#D4D4D4"> != </span><span style="color:#569CD6">nil</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#C586C0">        return</span><span style="color:#4EC9B0"> Dir</span><span style="color:#D4D4D4">{}, </span><span style="color:#9CDCFE">err</span></span>
<span class="line"><span style="color:#D4D4D4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9CDCFE">    dir</span><span style="color:#D4D4D4"> := </span><span style="color:#DCDCAA">New</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">reader</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">DirPath</span><span style="color:#D4D4D4">(), </span><span style="color:#B5CEA8">100</span><span style="color:#D4D4D4">) </span><span style="color:#6A9955">// Produces a new empty Dir</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0">    for</span><span style="color:#9CDCFE"> _</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">fileInfo</span><span style="color:#D4D4D4"> := </span><span style="color:#C586C0">range</span><span style="color:#9CDCFE"> fileInfos</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#9CDCFE">        name</span><span style="color:#D4D4D4"> := </span><span style="color:#9CDCFE">fileInfo</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">Name</span><span style="color:#D4D4D4">()</span></span>
<span class="line"><span style="color:#C586C0">        if</span><span style="color:#D4D4D4"> !</span><span style="color:#9CDCFE">fileInfo</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">IsDir</span><span style="color:#D4D4D4">() {</span></span>
<span class="line"><span style="color:#9CDCFE">            dir</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">Files</span><span style="color:#D4D4D4"> = </span><span style="color:#DCDCAA">append</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">dir</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">Files</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">fileInfo</span><span style="color:#D4D4D4">)</span></span>
<span class="line"><span style="color:#C586C0">            continue</span></span>
<span class="line"><span style="color:#D4D4D4">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9CDCFE">        newPath</span><span style="color:#D4D4D4"> := </span><span style="color:#9CDCFE">filepath</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">Join</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">reader</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">DirPath</span><span style="color:#D4D4D4">(), </span><span style="color:#9CDCFE">name</span><span style="color:#D4D4D4">)</span></span>
<span class="line"><span style="color:#9CDCFE">        newReader</span><span style="color:#D4D4D4"> := </span><span style="color:#9CDCFE">reader</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">New</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">newPath</span><span style="color:#D4D4D4">)</span></span>
<span class="line"><span style="color:#9CDCFE">        subDir</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">err</span><span style="color:#D4D4D4"> := </span><span style="color:#DCDCAA">Scan</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">newReader</span><span style="color:#D4D4D4">)</span></span>
<span class="line"><span style="color:#C586C0">        if</span><span style="color:#9CDCFE"> err</span><span style="color:#D4D4D4"> != </span><span style="color:#569CD6">nil</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#C586C0">            return</span><span style="color:#4EC9B0"> Dir</span><span style="color:#D4D4D4">{}, </span><span style="color:#9CDCFE">err</span></span>
<span class="line"><span style="color:#D4D4D4">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9CDCFE">        dir</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">SubDirs</span><span style="color:#D4D4D4">[</span><span style="color:#9CDCFE">name</span><span style="color:#D4D4D4">] = </span><span style="color:#9CDCFE">subDir</span></span>
<span class="line"><span style="color:#D4D4D4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0">    return</span><span style="color:#9CDCFE"> dir</span><span style="color:#D4D4D4">, </span><span style="color:#569CD6">nil</span></span>
<span class="line"><span style="color:#D4D4D4">}</span></span></code></pre> <h3><code>MockDir</code> methods</h3> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#569CD6">func</span><span style="color:#D4D4D4"> (</span><span style="color:#9CDCFE">md </span><span style="color:#4EC9B0">MockDir</span><span style="color:#D4D4D4">) </span><span style="color:#DCDCAA">DirPath</span><span style="color:#D4D4D4">() </span><span style="color:#4EC9B0">string</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#C586C0">    return</span><span style="color:#9CDCFE"> md</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">Path</span></span>
<span class="line"><span style="color:#D4D4D4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6">func</span><span style="color:#D4D4D4"> (</span><span style="color:#9CDCFE">md </span><span style="color:#4EC9B0">MockDir</span><span style="color:#D4D4D4">) </span><span style="color:#DCDCAA">Readdir</span><span style="color:#D4D4D4">() ([]</span><span style="color:#4EC9B0">os</span><span style="color:#D4D4D4">.</span><span style="color:#4EC9B0">FileInfo</span><span style="color:#D4D4D4">, </span><span style="color:#4EC9B0">error</span><span style="color:#D4D4D4">) {</span></span>
<span class="line"><span style="color:#9CDCFE">    files</span><span style="color:#D4D4D4"> := </span><span style="color:#DCDCAA">make</span><span style="color:#D4D4D4">([]</span><span style="color:#4EC9B0">os</span><span style="color:#D4D4D4">.</span><span style="color:#4EC9B0">FileInfo</span><span style="color:#D4D4D4">, </span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">, </span><span style="color:#B5CEA8">10</span><span style="color:#D4D4D4">)</span></span>
<span class="line"><span style="color:#C586C0">    for</span><span style="color:#9CDCFE"> _</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">file</span><span style="color:#D4D4D4"> := </span><span style="color:#C586C0">range</span><span style="color:#9CDCFE"> md</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">Files</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#9CDCFE">        files</span><span style="color:#D4D4D4"> = </span><span style="color:#DCDCAA">append</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">files</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">file</span><span style="color:#D4D4D4">)</span></span>
<span class="line"><span style="color:#D4D4D4">    }</span></span>
<span class="line"><span style="color:#C586C0">    for</span><span style="color:#9CDCFE"> dirName</span><span style="color:#D4D4D4"> := </span><span style="color:#C586C0">range</span><span style="color:#9CDCFE"> md</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">SubDirs</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#9CDCFE">        files</span><span style="color:#D4D4D4"> = </span><span style="color:#DCDCAA">append</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">files</span><span style="color:#D4D4D4">, </span><span style="color:#DCDCAA">NewMockFileInfo</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">dirName</span><span style="color:#D4D4D4">, </span><span style="color:#569CD6">true</span><span style="color:#D4D4D4">))</span></span>
<span class="line"><span style="color:#D4D4D4">    }</span></span>
<span class="line"><span style="color:#C586C0">    return</span><span style="color:#9CDCFE"> files</span><span style="color:#D4D4D4">, </span><span style="color:#569CD6">nil</span></span>
<span class="line"><span style="color:#D4D4D4">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6">func</span><span style="color:#D4D4D4"> (</span><span style="color:#9CDCFE">md </span><span style="color:#4EC9B0">MockDir</span><span style="color:#D4D4D4">) </span><span style="color:#DCDCAA">New</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">path</span><span style="color:#4EC9B0"> string</span><span style="color:#D4D4D4">) </span><span style="color:#4EC9B0">DirReader</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#C586C0">    for</span><span style="color:#9CDCFE"> _</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">dir</span><span style="color:#D4D4D4"> := </span><span style="color:#C586C0">range</span><span style="color:#9CDCFE"> md</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">SubDirs</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#C586C0">        if</span><span style="color:#9CDCFE"> dir</span><span style="color:#D4D4D4">.</span><span style="color:#9CDCFE">Path</span><span style="color:#D4D4D4"> == </span><span style="color:#9CDCFE">path</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#C586C0">            return</span><span style="color:#9CDCFE"> dir</span></span>
<span class="line"><span style="color:#D4D4D4">        }</span></span>
<span class="line"><span style="color:#D4D4D4">    }</span></span>
<span class="line"><span style="color:#9CDCFE">    emptyDirs</span><span style="color:#D4D4D4"> := </span><span style="color:#DCDCAA">make</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">map</span><span style="color:#D4D4D4">[</span><span style="color:#4EC9B0">string</span><span style="color:#D4D4D4">]*</span><span style="color:#4EC9B0">MockDir</span><span style="color:#D4D4D4">)</span></span>
<span class="line"><span style="color:#C586C0">    return</span><span style="color:#4EC9B0"> MockDir</span><span style="color:#D4D4D4">{</span><span style="color:#9CDCFE">path</span><span style="color:#D4D4D4">, </span><span style="color:#DCDCAA">make</span><span style="color:#D4D4D4">([]</span><span style="color:#4EC9B0">os</span><span style="color:#D4D4D4">.</span><span style="color:#4EC9B0">FileInfo</span><span style="color:#D4D4D4">, </span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">), </span><span style="color:#9CDCFE">emptyDirs</span><span style="color:#D4D4D4">}</span></span>
<span class="line"><span style="color:#D4D4D4">}</span></span></code></pre> <h3><code>MockFileInfo</code></h3> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#569CD6">func</span><span style="color:#DCDCAA"> NewMockFileInfo</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">name</span><span style="color:#4EC9B0"> string</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">isDir</span><span style="color:#4EC9B0"> bool</span><span style="color:#D4D4D4">) </span><span style="color:#4EC9B0">MockFileInfo</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#C586C0">    return</span><span style="color:#4EC9B0"> MockFileInfo</span><span style="color:#D4D4D4">{</span></span>
<span class="line"><span style="color:#9CDCFE">        FileName</span><span style="color:#D4D4D4">:    </span><span style="color:#9CDCFE">name</span><span style="color:#D4D4D4">,</span></span>
<span class="line"><span style="color:#9CDCFE">        IsDirectory</span><span style="color:#D4D4D4">: </span><span style="color:#9CDCFE">isDir</span><span style="color:#D4D4D4">,</span></span>
<span class="line"><span style="color:#D4D4D4">    }</span></span>
<span class="line"><span style="color:#D4D4D4">}</span></span></code></pre> <h3><code>NewMockDir</code></h3> <pre class="astro-code dark-plus" style="background-color:#1E1E1E;color:#D4D4D4; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#569CD6">func</span><span style="color:#DCDCAA"> NewMockDir</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">rootPath</span><span style="color:#4EC9B0"> string</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">files</span><span style="color:#D4D4D4"> ...</span><span style="color:#4EC9B0">string</span><span style="color:#D4D4D4">) </span><span style="color:#4EC9B0">MockDir</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#9CDCFE">    topFiles</span><span style="color:#D4D4D4"> := </span><span style="color:#DCDCAA">make</span><span style="color:#D4D4D4">([]</span><span style="color:#4EC9B0">os</span><span style="color:#D4D4D4">.</span><span style="color:#4EC9B0">FileInfo</span><span style="color:#D4D4D4">, </span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">, </span><span style="color:#B5CEA8">10</span><span style="color:#D4D4D4">)</span></span>
<span class="line"><span style="color:#9CDCFE">    subDirs</span><span style="color:#D4D4D4"> := </span><span style="color:#DCDCAA">make</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">map</span><span style="color:#D4D4D4">[</span><span style="color:#4EC9B0">string</span><span style="color:#D4D4D4">]*</span><span style="color:#4EC9B0">MockDir</span><span style="color:#D4D4D4">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0">    for</span><span style="color:#9CDCFE"> _</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">file</span><span style="color:#D4D4D4"> := </span><span style="color:#C586C0">range</span><span style="color:#9CDCFE"> files</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#C586C0">        if</span><span style="color:#9CDCFE"> strings</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">Contains</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">file</span><span style="color:#D4D4D4">, </span><span style="color:#CE9178">"_"</span><span style="color:#D4D4D4">) {</span></span>
<span class="line"><span style="color:#9CDCFE">            parts</span><span style="color:#D4D4D4"> := </span><span style="color:#9CDCFE">strings</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">Split</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">file</span><span style="color:#D4D4D4">, </span><span style="color:#CE9178">"_"</span><span style="color:#D4D4D4">)</span></span>
<span class="line"><span style="color:#9CDCFE">            dirName</span><span style="color:#D4D4D4"> := </span><span style="color:#9CDCFE">parts</span><span style="color:#D4D4D4">[</span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">]</span></span>
<span class="line"><span style="color:#9CDCFE">            subFile</span><span style="color:#D4D4D4"> := </span><span style="color:#DCDCAA">NewMockFileInfo</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">parts</span><span style="color:#D4D4D4">[</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">], </span><span style="color:#569CD6">false</span><span style="color:#D4D4D4">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0">            if</span><span style="color:#9CDCFE"> _</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">exist</span><span style="color:#D4D4D4"> := </span><span style="color:#9CDCFE">subDirs</span><span style="color:#D4D4D4">[</span><span style="color:#9CDCFE">dirName</span><span style="color:#D4D4D4">]; </span><span style="color:#9CDCFE">exist</span><span style="color:#D4D4D4"> {</span></span>
<span class="line"><span style="color:#D4D4D4">                (*</span><span style="color:#9CDCFE">subDirs</span><span style="color:#D4D4D4">[</span><span style="color:#9CDCFE">dirName</span><span style="color:#D4D4D4">]).</span><span style="color:#9CDCFE">Files</span><span style="color:#D4D4D4"> = </span><span style="color:#DCDCAA">append</span><span style="color:#D4D4D4">((*</span><span style="color:#9CDCFE">subDirs</span><span style="color:#D4D4D4">[</span><span style="color:#9CDCFE">dirName</span><span style="color:#D4D4D4">]).</span><span style="color:#9CDCFE">Files</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">subFile</span><span style="color:#D4D4D4">)</span></span>
<span class="line"><span style="color:#C586C0">                continue</span></span>
<span class="line"><span style="color:#D4D4D4">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9CDCFE">            subDirs</span><span style="color:#D4D4D4">[</span><span style="color:#9CDCFE">dirName</span><span style="color:#D4D4D4">] = &#x26;</span><span style="color:#4EC9B0">MockDir</span><span style="color:#D4D4D4">{</span><span style="color:#9CDCFE">filepath</span><span style="color:#D4D4D4">.</span><span style="color:#DCDCAA">Join</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">rootPath</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">dirName</span><span style="color:#D4D4D4">), []</span><span style="color:#4EC9B0">os</span><span style="color:#D4D4D4">.</span><span style="color:#4EC9B0">FileInfo</span><span style="color:#D4D4D4">{</span><span style="color:#9CDCFE">subFile</span><span style="color:#D4D4D4">}, </span><span style="color:#569CD6">nil</span><span style="color:#D4D4D4">}</span></span>
<span class="line"><span style="color:#C586C0">            continue</span></span>
<span class="line"><span style="color:#D4D4D4">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9CDCFE">        topFiles</span><span style="color:#D4D4D4"> = </span><span style="color:#DCDCAA">append</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">topFiles</span><span style="color:#D4D4D4">, </span><span style="color:#DCDCAA">NewMockFileInfo</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">file</span><span style="color:#D4D4D4">, </span><span style="color:#569CD6">false</span><span style="color:#D4D4D4">))</span></span>
<span class="line"><span style="color:#D4D4D4">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C586C0">    return</span><span style="color:#4EC9B0"> MockDir</span><span style="color:#D4D4D4">{</span><span style="color:#9CDCFE">rootPath</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">topFiles</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">subDirs</span><span style="color:#D4D4D4">}</span></span>
<span class="line"><span style="color:#D4D4D4">}</span></span></code></pre>  </article> </main> </div> </div>  <!-- Global styles for .post-layout and .post-layout-sidebar -->  </body></html>